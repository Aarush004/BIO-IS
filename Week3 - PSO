import numpy as np
import random

random.seed(42)
np.random.seed(42)

def sphere_function(position):
    return np.sum(position ** 2)

def pso_optimizer(
    objective_func,
    num_particles=30,
    dimensions=2,
    search_range=(-10, 10),
    max_iterations=100,
    w=0.729,
    c1=1.4944,
    c2=1.4944
):
    min_bound, max_bound = search_range
    positions = np.random.uniform(min_bound, max_bound, (num_particles, dimensions))
    velocities = np.random.uniform(-1, 1, (num_particles, dimensions))
    pbest_positions = positions.copy()
    pbest_scores = np.array([objective_func(p) for p in positions])
    gbest_index = np.argmin(pbest_scores)
    gbest_position = pbest_positions[gbest_index].copy()
    gbest_score = pbest_scores[gbest_index]

    for iteration in range(max_iterations):
        for i in range(num_particles):
            score = objective_func(positions[i])
            if score < pbest_scores[i]:
                pbest_scores[i] = score
                pbest_positions[i] = positions[i].copy()

        current_best_index = np.argmin(pbest_scores)
        if pbest_scores[current_best_index] < gbest_score:
            gbest_score = pbest_scores[current_best_index]
            gbest_position = pbest_positions[current_best_index].copy()

        r1 = np.random.rand(num_particles, dimensions)
        r2 = np.random.rand(num_particles, dimensions)
        inertia = w * velocities
        cognitive = c1 * r1 * (pbest_positions - positions)
        social = c2 * r2 * (gbest_position - positions)
        velocities = inertia + cognitive + social
        positions += velocities
        positions = np.clip(positions, min_bound, max_bound)

        print(f"Iteration {iteration+1:3d} | Best Score: {gbest_score:.6e} | Best Position: {gbest_position}")

    return gbest_position, gbest_score

def run_pso_example():
    best_position, best_score = pso_optimizer(
        objective_func=sphere_function,
        num_particles=30,
        dimensions=2,
        search_range=(-5.12, 5.12),
        max_iterations=50
    )

    print("\n--- Final Results ---")
    print(f"Best Position: {best_position}")
    print(f"Minimum Score: {best_score:.6e}")

if __name__ == '__main__':
    run_pso_example()
